# 外部設計書

## 1. 概要

本ドキュメントは、「ビジネスメールタイピング」の外部設計を定義するものである。
要件定義書に基づき、画面仕様、機能仕様、データ構造などを具体的に定める。

## 2. 画面設計

詳細は `20_画面設計書.md` を参照。

## 3. 機能仕様

### 3.1. UI状態管理機能

- ナビゲーションパネルの選択に応じて、中央のパネルと右側のパネルの表示を切り替える。
  - 「出題トレイ」選択時:
    - 中央のパネルに「お題リスト」を表示する。
    - 右側のパネルに「受信メール詳細エリア」を表示する（初期状態）。
  - 「履歴」選択時:
    - 中央のパネルに「履歴リスト」を表示する。
    - 右側のパネルは非表示にするか、履歴詳細を表示する（今回は履歴リストのみ）。
- お題リストからお題を選択すると、右側の「受信メール詳細エリア」に内容をセットし、表示する。
- 受信メール詳細エリアの「返信」ボタンをクリックすると、右側のパネルを「入力エリア」と「返信メール見本エリア」に切り替え、タイピングゲームを開始する。

### 3.2. タイピング機能

- ユーザーがお題を選択すると、タイマーがリセットされ、入力エリアが有効になる。
- 最初のキーが押された瞬間から、タイマーを開始する。
- 入力された文字を1文字ずつ判定し、画面にフィードバックする。
- お題の最後の文字まで入力が完了した時点で、タイマーを停止し、最終結果を計算・表示する。
- **ゴーストテキスト表示**: 入力エリアに、タイピング対象のテキストの現在行と次の2行程度を薄い文字色で表示する。

### 3.2. 採点機能

- **Time:** タイマーの開始から停止までの時間（秒）。
- **Accuracy:** `(正しい入力数 / 全入力数) * 100` で計算。
- **WPM:** `(正しい入力文字数 / 5 / 経過時間（分）)` で計算。※5文字で1ワードと換算

### 3.3. お題管理機能

- 外部JSONファイル (`questions.json`) からお題を読み込む。
- アプリケーション起動時にJSONを非同期でフェッチし、お題選択エリアを生成する。

### 3.4. ユーザー情報管理機能

- アプリケーション初回起動時に、ローカルストレージにユーザー情報が存在するか確認する。
- 存在しない場合は、設定モーダルを表示して入力を促す。
- ユーザーが入力した会社名と名前をローカルストレージに保存する。
- 設定ボタンから、いつでも情報を更新できるようにする。

### 3.5. お題への情報反映機能

- お題を画面に表示する際、本文中の特定のプレースホルダーを、ローカルストレージに保存されたユーザー情報に置き換える。
  - `{{user_company}}` -> ユーザーの会社名
  - `{{user_name}}` -> ユーザーの名前

### 3.6. データ保存機能

- タイピング完了時、算出されたWPMが既存のハイスコアを上回っていた場合、ローカルストレージに新しいハイスコアを保存する。

## 4. URL設計

- 静的な単一ページアプリケーションのため、以下のURLのみとする。
  - `(ルート)/index.html`

## 5. データ構造

### 5.1. お題データ (`questions.js`)

PM業務で頻出する状況を想定したメールシナリオを定義する。
詳細は `30_問題集.md` を参照。


### 5.2. ローカルストレージ

- **ハイスコア**
  - キー: `typingGameHighScore`
  - 値: `123.45` (WPMの数値)
- **ユーザー情報**
  - キー: `typingGameUserInfo`
  - 値: `{"company": "株式会社△△", "name": "佐藤", "customer_company": "株式会社B", "customer_name": "田中"}` (JSON文字列)
- **タイピング履歴**
  - キー: `typingGameHistory`
  - 値: `[{"questionId": 1, "title": "進捗報告（順調）", "wpm": 80.5, "accuracy": 98.2, "date": "2023-10-26T10:00:00Z"}, ...]` (JSON文字列の配列)
