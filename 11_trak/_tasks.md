# Cline に外部設計～実装をさせる

AIに「いい感じに」というとそこそこいい感じに作ってくれるが、それなりに「思った通り」にしようとした場合、思ったことを伝える必要がある。
ただ、それを全部行うと大変なので、要件定義をまず書き、外部設計をAIに実施させ、それをレビューした上で実装をさせる方針で進める。

以下、外部設計～実装までのプロンプトを記載しておく。

## セットアップ
1. 
日本語でお願いします。
00_要件/要件.md を見て、memory-bank を作成してください。

## 外部設計
1.
日本語でお願いします。
00_要件/要件.md を見て、10_外部設計/ フォルダに外部設計書を作成してください。
- 機能仕様書
- 画面仕様書
- データ・設定ファイル仕様書

2.
チケットテンプレートは templates/ フォルダに複数持てるようにしてください。

templates/
  タスク.md
  障害票.md

起票画面で、テンプレート選択もできるようにしてください。

3.
各データや設定ファイルフォルダは、trak-data/ フォルダの配下としてください。

4.
update memory bank

## 実装

### プロジェクト作成
1. (手動：自動でもできるが思った通りにするのが面倒なので)
next プロジェクト作成
```
cd 30_src
npx create-next-app@latest --ts

√ What is your project named? ... trak
√ Would you like to use ESLint? ... No / Yes
√ Would you like to use Tailwind CSS? ... No / Yes
√ Would you like your code inside a `src/` directory? ... No / Yes
√ Would you like to use App Router? (recommended) ... No / Yes
√ Would you like to use Turbopack for `next dev`? ... No / Yes
√ Would you like to customize the import alias (`@/*` by default)? ... No / Yes
```

### とりあえず作る
1.
日本語でお願いします。
10_外部設計/ に従って、30_src/trak/ フォルダに nextjs アプリを作成してください。

ベースとなるフォルダ構成は以下としてください。
util 等必要なフォルダは適宜追加してください。

```
app/ # app router
auth/ # 認証処理
components/ # ui components
viewmodels/ # 表示用モデル
repository/ # フロントエンドからバックエンドのデータ操作
backend/ # backend
  logic/ # ビジネスロジック
  services/ # データ操作サービス
  models/ # データモデル
```

認証には、NextAuth を利用してください。

--
ちなみにファイル管理でデータベースは利用しない想定でしたが、prisma はオンメモリDBとかなにかですか？

--
基本的にはスタンドアローンでステータスやチケット更新ができれば大丈夫です。
他のユーザーとの共有は、track-data/ を git にコミットすることで共有できればいいと考えます。
(同じチケットの同時更新はほぼ発生しない想定)

--
方向性大丈夫です。
ユーザーは trak-data/configs/users.json から読み込む形にしてください。

### 次の作業に向けて仕様書調整
1.
日本語でお願いします。
10_外部設計\02_画面仕様書.md に、各画面のIDとURLを追加してください。
ID書式 : SC{3桁の識別番号}

画面IDは後で画面が追加になってもいいように、100の位や10の位を塊ごとで増やして採番してください。

### メインページ作成
1.
画面仕様書に沿って、メインページの実装をお願いします。

2.
日本語でお願いします。
こちらメインページになるページかと思いますが、作成したコンポーネントを配置してください。
30_src\trak\src\app\page.tsx

### チケット作成/編集画面作成
1.
チケット作成/編集画面 の作成をお願いします。
- 画面ID: SC301
- URL: /tickets/new（新規作成）, /tickets/[id]/edit（編集）

2.
メイン画面の[新規チケット]ボタン押下で、新規チケット作成画面に遷移するようにしてください。

3.
チケット作成画面の担当者欄は、users.json に存在するユーザーにしてください。

4.
ステータス設定も、以下設計に従い作成してください。
10_外部設計\03_データ・設定ファイル仕様書.md

項目は以下の順番で、configs/statuses.json に定義してください。
- Open
- In Progress
- In Review
- Completed
- Close
- Blocked
- Waiting

定義ができたら、チケット作成画面でそれを読み込むように修正してください。

5.
10_外部設計\03_データ・設定ファイル仕様書.md に沿って、trak-data/templates/ フォルダにテンプレートファイル(md)を作成してください。

000_タスク.md テンプレートは以下の通り。
```
# [チケットタイトル]

## 概要
[概要を記載してください]

## 詳細
[詳細な内容を記載してください]

## 参考情報
- [参考リンクや関連情報があれば記載してください]
```

001_障害票.md テンプレートは以下の通り。
```
# [チケットタイトル]

## 事象
[起票者記載]

## 再現手順
[起票者記載]

## 原因
[対応者記載]

## 対応内容
[対応者記載]
```

テンプレートドロップダウンには、ファイル名の_以降の部分を表示。
内容部分には、選択したテンプレートの内容を表示。
内容部分は、マークダウンエディタになっていることが望ましいです。

6.
- 担当者欄をインクリメンタルサーチドロップダウンに
- 担当者、ステータス、期限、見積欄を横一列表示に
- テンプレート選択欄は、内容欄のすぐ上に

7.
一旦、ここまでの実装を画面設計書に書き戻してもらえますか？

8.
チケット作成/編集画面（SC301）のテンプレートを、templates/ から読み込んだ内容を表示するようにしてください。

9.
mui はちょっと場所をとるというか、最近は流行らないのでシンプルなUIに置き換えられますか？

10.
30_src\trak\src\styles\site.scss を作成して、おしゃれなスタイリングしてもらえますか？

11.
担当者のところがレイアウトが崩れていますが、モダンになりました。
あと、担当者は、表示名または email でインクリメンタルサーチできるようにしてください。

12.
入力欄を以下の様にしてください
タイトル
起票者,ステータス,開始日,期限,見積
担当者
テンプレート
内容

担当者部は、ラベル　入力部を横に並べてください（高さを取らないように）

13.
起票者はログインユーザーを固定でセットで、選択不可で大丈夫です。
データとしてはメールアドレスを保存するようにしてください。
users json の値が読めてなさそうです。

14.
statuses.json では色も指定できるようにしてください。
ステータスのドロップダウンは指定された色を背景色にしてください。
色が暗い場合は文字色が白になるようにしてください。

担当者タグは、16色程度用意しておき、ユーザーidに応じた色となるようにしてください。

15.
保存ボタン押下で、
trak-data/tickets/ に内容本文、
trak-data/trackings/ にその他情報を保存してください。

16.
以下実装をお願いします。
- チケットCRUD操作 (/api/tickets)
- チケット作成/編集画面（SC301）からの保存

### メインページ作成(2)
1.
チケット一覧をAPIで取得してテーブルに表示してください。

2.
IDクリックで編集画面を表示するようにしてください。
その他項目は、クリックして直接編集、フォーカス off で保存としてください。

3.
- ステータス
編集画面同様、色付きドロップダウンにしてください。
- 担当者
編集画面同様、インクリメンタルサーチドロップダウンにしてください。
- 開始日、期限
カレンダーにしてください

4.
見積もりは、テキスト入力にしてください
小数の数字と h, d を入力として受付・表示をしてください。内部では時間単位で保持してください
