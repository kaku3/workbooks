{
  "id": "copy_paste_bug",
  "title": "コピペの変数名ミス",
  "level": "advanced",
  "description": "以下は3つの商品カテゴリ（electronics、furniture、clothing）の価格を計算する関数です。\n\n各カテゴリには基本価格があり、以下のルールで最終価格を算出します：\n- electronics: 基本価格 + 10% の税金 + 500円の配送料\n- furniture: 基本価格 + 10% の税金 + 2000円の配送料\n- clothing: 基本価格 + 10% の税金 + 300円の配送料\n\n現在、furnitureの価格計算が正しく動作していません。\n\n※ ヒント：コードをよく見ると、3つの計算処理が似た構造をしています。これは何を意味するでしょうか？",
  "initialCode": "function calculateElectronicsPrice(basePrice) {\n  const tax = basePrice * 0.1;\n  const shipping = 500;\n  const electronicsTotal = basePrice + tax + shipping;\n  return electronicsTotal;\n}\n\nfunction calculateFurniturePrice(basePrice) {\n  const tax = basePrice * 0.1;\n  const shipping = 2000;\n  const furnitureTotal = basePrice + tax + shipping;\n  return electronicsTotal;\n}\n\nfunction calculateClothingPrice(basePrice) {\n  const tax = basePrice * 0.1;\n  const shipping = 300;\n  const clothingTotal = basePrice + tax + shipping;\n  return clothingTotal;\n}\n\nfunction testPriceCalculation(testCase) {\n  if (testCase.category === 'electronics') {\n    return calculateElectronicsPrice(testCase.basePrice);\n  } else if (testCase.category === 'furniture') {\n    return calculateFurniturePrice(testCase.basePrice);\n  } else if (testCase.category === 'clothing') {\n    return calculateClothingPrice(testCase.basePrice);\n  }\n  return 0;\n}",
  "hint": "3つの関数が似た構造をしているのは、コピー&ペーストで作られた可能性が高いです。コピペ後に変更すべき箇所がすべて変更されているか、1行ずつ確認してください。特に変数名に注目！",
  "explanation": "この問題の教訓は **「コピペコードの危険性」** と **「変数名の一貫性の重要性」** です。\n\n**バグの内容**: calculateFurniturePrice関数の最後で、`furnitureTotal` を返すべきところを `electronicsTotal` を返しています。これは明らかにコピペミスです。\n\n**なぜ見つけにくいのか**: (1)コードの構造が似ている - 3つの関数がほぼ同じ構造なので、細かい違いを見落としやすい。(2)計算ロジックは正しい - 税金や配送料の計算式は正しいので、そちらに意識が向きがち。(3)変数は定義されている - `electronicsTotal` は別の関数で定義されているため、構文エラーにならない（実行時にundefinedが返る）。\n\n**コピペコードの典型的な問題**: このようなコードは、(1)`calculateElectronicsPrice` を最初に実装、(2)それをコピーして `calculateFurniturePrice` を作成、(3)関数名、変数名を変更すべき箇所を変更、(4)しかし、return文の変数名を変更し忘れる、というプロセスで生まれます。\n\n**実践での教訓**: (1)コピペは慎重に - コピペ後は、すべての箇所を確認する。(2)命名規則を統一 - `total` だけにするなど、シンプルな変数名にすれば間違えにくい。(3)テストを書く - 各関数が期待通りの値を返すかテストする。(4)重複コードは共通化 - 同じロジックなら、パラメータ化して1つの関数にまとめる。\n\n**推奨される改善**:\n```javascript\nfunction calculatePrice(basePrice, shippingFee) {\n  const tax = basePrice * 0.1;\n  const total = basePrice + tax + shippingFee;\n  return total;\n}\n\nfunction calculateElectronicsPrice(basePrice) {\n  return calculatePrice(basePrice, 500);\n}\n\nfunction calculateFurniturePrice(basePrice) {\n  return calculatePrice(basePrice, 2000);\n}\n\nfunction calculateClothingPrice(basePrice) {\n  return calculatePrice(basePrice, 300);\n}\n```\n\nこうすれば、コピペミスは防げます。",
  "testCases": [
    {
      "input": [{ "category": "electronics", "basePrice": 1000 }],
      "expectedOutput": 1600,
      "description": "電化製品: 1000円 + 100円(税) + 500円(配送) = 1600円"
    },
    {
      "input": [{ "category": "furniture", "basePrice": 10000 }],
      "expectedOutput": 13000,
      "description": "家具: 10000円 + 1000円(税) + 2000円(配送) = 13000円"
    },
    {
      "input": [{ "category": "clothing", "basePrice": 5000 }],
      "expectedOutput": 5800,
      "description": "衣類: 5000円 + 500円(税) + 300円(配送) = 5800円"
    },
    {
      "input": [{ "category": "electronics", "basePrice": 50000 }],
      "expectedOutput": 55500,
      "description": "高額電化製品: 50000円 + 5000円(税) + 500円(配送) = 55500円"
    }
  ]
}
