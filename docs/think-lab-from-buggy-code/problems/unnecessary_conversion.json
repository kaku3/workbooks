{
  "id": "unnecessary_conversion",
  "title": "不要な変換チェーン",
  "level": "advanced",
  "description": "以下は商品価格を計算する関数です。この会社では以下のルールがあります：\n\n1. 価格は内部的にポイント単位で管理（1ポイント = 10円）\n2. 割引計算は円単位で行う\n3. 10%の割引を適用\n4. 最終的にポイント単位で返す（例：100ポイント → 90ポイント）\n\n現在、calculateFinalPrice(100) を実行すると、期待値は 90ポイント なのに、なぜか 9000 が返ってきます。\n\nどこが間違っているのでしょうか？",
  "initialCode": "// ポイントを円に変換\nfunction pointsToYen(points) {\n  return points * 10; // 1ポイント = 10円\n}\n\n// 円をポイントに変換\nfunction yenToPoints(yen) {\n  return yen / 10; // 10円 = 1ポイント\n}\n\n// 割引を適用（10%オフ）\nfunction applyDiscount(priceInYen) {\n  const discountRate = 0.1;\n  const discountedPrice = priceInYen * (1 - discountRate);\n  return discountedPrice;\n}\n\n// 最終価格を計算\nfunction calculateFinalPrice(points) {\n  // ポイントを円に変換\n  const priceInYen = pointsToYen(points);\n  \n  // 念のため一度ポイントに戻す\n  const priceInPoints = yenToPoints(priceInYen);\n  \n  // 再度円に変換\n  const finalPriceInYen = pointsToYen(priceInPoints);\n  \n  // 割引を適用\n  const discountedPrice = applyDiscount(finalPriceInYen);\n  \n  // ポイントに変換して返す\n  const result = pointsToYen(discountedPrice);\n  \n  return result;\n}\n\nfunction testCalculation() {\n  // 100ポイント → 1000円 → 10%割引で900円 → 90ポイント\n  return calculateFinalPrice(100);\n}",
  "hint": "各ステップで、変数が「ポイント」なのか「円」なのかを追跡してみましょう。特に最後の行で、`discountedPrice`は円単位ですが、それを何に変換していますか？変数名と関数名をよく見比べてください。",
  "explanation": "この問題の教訓は **「不要な複雑さの中に隠れた致命的なバグ」** と **「変換関数の取り違え」** です。\n\n**バグの内容**: 最後の行で `discountedPrice`（900円）に対して、ポイントへの変換関数 `yenToPoints()` を使うべきところを、逆の `pointsToYen()` を使っているため、9000円という間違った結果になっています。正しくは `yenToPoints(900)` で90ポイントです。\n\n**なぜこうなったか**: (1)ポイント→円→ポイント→円という無意味な変換の往復が存在し、(2)その複雑さに気を取られている間に、本質的なバグ（変換関数の取り違え）を見落としています。コードが長く複雑なほど、ミスしやすく気づきにくくなります。\n\n**正しい修正**:\n```javascript\nfunction calculateFinalPrice(points) {\n  const priceInYen = pointsToYen(points);  // 100ポイント → 1000円\n  const discountedPrice = applyDiscount(priceInYen);  // 900円\n  const result = yenToPoints(discountedPrice);  // 90ポイント\n  return result;\n}\n```\n\nさらにシンプルに: `return points * 0.9;`\n\n**実践での教訓**: (1)不要な複雑さは削除する - 「念のため」が積み重なると本質的なバグを隠す。(2)変換関数は慎重に - A→B と B→A を間違えると結果が桁違いに。(3)変数名と単位を意識する。(4)単純化する勇気を持つ。(5)コードレビューで第三者の目を入れる。",
  "testCases": [
    {
      "input": [],
      "expectedOutput": 90,
      "description": "100ポイントに10%割引を適用すると90ポイントになるはず"
    }
  ]
}
