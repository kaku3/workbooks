@import "./style.less"

# インタラクティブサイトマップ

## システム開発の工程

突然だが、システム開発の工程についておさらいをする。

@import "./images/it.drawio.png"

あなたがエンジニアでプログラムを書ける人間だとすると、図中の「製造」の工程を担当することになるだろう。
もしもあなたが「プログラムしか書けない」人間だった場合、あなたの仕事を発生させるためには「要件定義」「外部設計」「詳細設計」といった工程を（案件によって呼称は異なる）他の誰かが行わなければならない。

製造以外の工程を他の人間に委ねてしまうと、図の通り「仕事がない期間」が発生してしまう。
フリーランスとしてやっていく場合、「仕事がない期間」はそのまま収入減につながるため、できる限り仕事がない期間の発生は避けたいだろう。

「仕事がない期間」を避けるオプションは３通りあると思う。
1. 営業と仲良くなる
2. 営業力をつける
3. 製造以外の工程もできるようになる

製造以外やりたくないのであれば、1 のオプションを選択することになると思うが、おそらく限界がある。
営業としても、 **『製造しかできない人間』** より **『どの工程でもできる人間』** の方が営業しやすいはずだ。単純に入れる案件が増えるのだから。

また、1や2のオプションは、仕事の総量を増やすのではなく、『存在している仕事を自分が取りやすくする』という考え方なので、長期的に見ると『仕事がない状態』に陥る懸念はやはり残る。

「本当はシステム開発した方がよい業務はたくさんあるが案件化できていない」という現状を鑑みると、要件定義～外部設計他全工程をできる様になる方が生存戦略としてはスジがよいし、 **業界全体としても何でもできる人を求める傾向は今後も強まっていく**と思う。


## 業務の理解

いきなり他業種の業務を理解するのは難しいので、ITの業務について考えることにする。
短納期、低予算化が進むと、プロジェクト進行の属人化が進んだり、最終的に動作するプログラム以外の物の製造がおざなりになったりする。

今回はWebサイト / Webアプリ制作における「サイトマップ」について考える。

@import "./images/sitemap.png"

Webサイト開発と言っても、『魅力的なランディングページを作る』案件や、３ページぐらいしか作らない様な案件では必ずしも「サイトマップ」を作る必要はないだろう。

この**必ずしも作る必要がない**というのが曲者だ。
作る必要がある案件にあたった時に **「作る必要があると気づかない」** 上に **「作れない」** という状況に遭遇するのだ。
30ページや50ページあるようなWebサイトを作成するのにサイトの全容が分かる設計図が存在しないとすると、製造も試験も正しく行われるかが分からなくなるのだが、 **いつも作らないでできていた** ところに膨大な工数をかけることはなかなか難しいようだ。

本課題では、決められたプログラムを書くのではなく、業務上の課題をどのように解決するかというところから考えてほしい。


## 要件定義

問題集として掲げる要件は以下とする。

- できるだけ工数をかけずにサイトマップを作成したい
- 作成したサイトマップは、顧客と共有できるものとする
  - 製造物の全容（開発規模）の承認が取れるものとする
- 製造工程以後でも使えるものとする


## 外部設計

ざっくり以下設計とした。

- できるだけ工数をかけずにサイトマップを作成したい
  - yaml でサイトマップ作成
    - git で変更管理可能
    - サイトマップ体裁(BOX描画・リンク)は自動的に描画される様にする
  - node.js ツールとする
    - ファイル変更を監視し、yaml -> html 変換を行う
    - VS Code の Live Server でプレビューとする(htmlが変更されると自動リロードされる)

  - 各画面イメージ作成には drawio.png を利用
    - 最終的には完成したサイトのスクリーンショットと置き換える

@import "./images/00_編集.gif"

- 作成したサイトマップは、顧客と共有できるものとする
  - 出力するサイトマップは、ローカルで動作する html とする

- 製造工程以後でも使えるものとする
  - 仕様をyamlに記載できるようにしておく

@import "./images/10_閲覧.gif"


### create-project.js

サイトマップの雛形を作成するコマンド。

yaml を1から書くのは難しい。
また、各ページには定形の内容を記載することになるので、雛形を作る機能を用意する。

以下の様な csv を用意し、これを元にサイトの雛形を作る。
@import "../10_src/10_sitemap/in/sitemap.csv"

#### 入出力
```
# 入力 :
sitemap.csv     # サイト定義ファイル
templates/
  html/
    index.html.ejs  # sitemap テンプレート
  images/
    confirm.drawio.png  # 確認ページ用テンプレート
    form.drawio.png     # form ページ用テンプレート
    list.drawio.png     # 一覧ページ用テンプレート
    top.drawio.png      # top ページ用テンプレート
  yml/
    page.yml            # yaml テンプレート

# 出力 :
out/
  html/
    index.html  # sitemap 本体
    styles/     # css
    images/     # 画面スクリーンショット置き場

```

#### コマンドライン
```
cd 04_インタラクティブサイトマップ/10_src/10_sitemap
# 初回のみ
npm install

# プロジェクト作成
# -i 入力ファイル(csv)
# -o 出力フォルダ
node create-project.js -i in/sitemap.csv -o out
```


### create-html.js

yaml から html を生成するコマンド。
※実運用では、watch.js を利用するため直接利用することはない。

#### コマンドライン

```
cd 04_インタラクティブサイトマップ/10_src/10_sitemap
# 初回のみ
npm install

# html 生成
# -i 入力ファイル(yaml)
# -o 出力フォルダ(html)
node create-html.js -i out/yml/@sitemap-index.yml -o out/html
```


#### watch.js

yaml の更新を監視し、create-html.js を呼び出すコマンド。

```
cd 04_インタラクティブサイトマップ/10_src/10_sitemap
# 初回のみ
npm install

# yaml 更新監視
# -i 入力ファイル(yaml)
# -o 出力フォルダ(html)
# -t 監視対象フォルダ
node watch.js -i out/yml/@sitemap-index.yml -o out/html -t out
```
