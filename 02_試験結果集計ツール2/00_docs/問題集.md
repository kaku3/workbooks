@import "./style.less"

# 試験結果集計ツール2


<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [試験結果集計ツール2](#試験結果集計ツール2)
  - [はじめに](#はじめに)
  - [要素技術](#要素技術)
  - [機能追加(集計) : 1](#機能追加集計-1)
    - [設計コラム : 『集計時に』ついて](#設計コラム-集計時について)
    - [事前にあるとよさそうな知識](#事前にあるとよさそうな知識)
    - [解答例](#解答例)
      - [変更箇所の確認](#変更箇所の確認)

<!-- /code_chunk_output -->


## はじめに

デイリーの集計が不要な小規模プロジェクトを考慮して、課題を分けました。

本課題の前に[試験結果集計ツール](../../01_%E8%A9%A6%E9%A8%93%E7%B5%90%E6%9E%9C%E9%9B%86%E8%A8%88%E3%83%84%E3%83%BC%E3%83%AB/00_docs/%E5%95%8F%E9%A1%8C%E9%9B%86.md)を実施しておいてください。

また、レポートを欲しがる上層部に http server を用意してくださいとは言えないので、実践的な html 版の課題が続きます。Nuxt.js 編の課題はもう少し後になります。


## 要素技術

- Node.js : 集計
- html, jQuery, DataTables : 表示
- chart.js : グラフ表示


## 機能追加(集計) : 1

Excel日付を表示用日付に変換する。
集計ツールで出力されたデータの試験実施日を確認すると以下のような値であることが確認できる。

```
"testDate":44844
```

これは、シリアル値と呼ばれるマイクロソフト独自の日時表現形式だ。

1900年1月1日を1として、以後24時間経過するごとに1を加える。
※1日未満は小数点で表現。

この値を表示しても試験実施日は分からないので、**集計時に**yyyy/mm/dd形式の値も保存する様に修正する。

```
"displayTestDate":"2022/10/10"
```


### 設計コラム : 『集計時に』ついて

シリアル値→日付変換は、計算で求まる値であるため集計時に保持する必要はない。
クライアント側で表示する時に計算で求めればデータを保持する量が少なくなるためDBやストレージには優しい。

ところが今回は、クライアント側を2種類(jQuery版、nuxt版)作成する計画がある。とした場合、それぞれのクライアントに対して日付変換処理を実装するよりは集計処理側に実装する方がコスパがよいと考えられる。

また、冒頭で述べた様に、このツールで出力される**レポートを閲覧するユーザーがサーバを用意できないといった条件がある場合**、実装者にとってはNuxt.jsやNext.jsで製造する方が簡単でも、それらのフレームワークを選択することはできなくなる。[^1]

このように、**最適な設計はシステムを取り巻く条件や環境**によって変わってくる。「なぜその設計にするのか」「メリット」「デメリット」などは常に考える様にしておくとよいでしょう。


### 事前にあるとよさそうな知識

- シリアル値
1900年1月1日から経過日数。

- [UNIX時間](https://ja.wikipedia.org/wiki/UNIX%E6%99%82%E9%96%93)
協定世界時 (UTC) での1970年1月1日午前0時0分0秒（UNIXエポック）から形式的な経過秒数。


### 解答例

[01_解答例_追加仕様_集計_1](../10_src/01_%E8%A7%A3%E7%AD%94%E4%BE%8B_%E8%BF%BD%E5%8A%A0%E4%BB%95%E6%A7%98_%E9%9B%86%E8%A8%88_1/convert.js)

#### 変更箇所の確認

今回の課題では既存ソースに対する修正を行った。変更箇所を確認するには、主に以下３通りの方法がある。現場によって使えるツールに制限があるが、新しくて簡単な方法をチェックする習慣は持っておいた方がいいだろう。

1. VS Code のタイムラインビューで確認
該当のコミットでの変更を確認できる。通常の開発で修正されたコードを確認するのであればこれを用いるのがよいと思う。

@import "./images/timeline-view.png"


また、Git管理下のファイルを確認するのであれば以下も併用したい。

- [GitHistory](https://marketplace.visualstudio.com/items?itemName=donjayamanne.githistory)
- [GitLens](https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens)

@import "./images/gitlens-githistory.png"

2. [Partial Diff](https://marketplace.visualstudio.com/items?itemName=ryu1kn.partial-diff) で確認
VS Code プラグインを追加し、変更元ソースと比較する。

3. [WinMerge](https://winmerge.org/?lang=ja) で確認
昭和から脈々と利用され続けているイニシエのツールを用いて比較する。


[^1]: どんなにプログラム的に最適で美しくても、ユーザーが使えないのであればそれはただのプログラムでありプロダクトではない。お金になるのはプログラムではなくプロダクト。


